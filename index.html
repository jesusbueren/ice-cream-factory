<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Production Theory: 3D Equilibrium</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 20px; color: #2c3e50; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Layout */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        .controls-panel { display: flex; flex-direction: column; gap: 15px; }
        .charts-panel { display: flex; flex-direction: column; gap: 20px; }
        
        /* Sliders & Stats */
        .control-card { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; }
        .slider-row { margin-bottom: 10px; }
        .slider-row label { display: block; font-size: 0.85em; margin-bottom: 5px; color: #bdc3c7; }
        input[type=range] { width: 100%; accent-color: #3498db; }
        
        .stat-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-box { background: #34495e; padding: 10px; border-radius: 6px; text-align: center; }
        .stat-label { font-size: 0.75em; color: #bdc3c7; display: block; }
        .stat-val { font-size: 1.1em; font-weight: bold; color: #2ecc71; }

        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        #plot3d { width: 100%; height: 450px; background: #fff; border-radius: 10px; border: 1px solid #eee; }
        
        .equation-label { font-family: "serif"; font-style: italic; font-size: 0.9em; color: #3498db; text-align: center; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Macroeconomic Production & Factor Income</h1>
        <p>Explore how technology and endowments determine prices and income shares.</p>
    </div>

    <div class="main-grid">
        <div class="controls-panel">
            
            <div class="control-card">
                <div class="slider-row">
                    <label>Capital Endowment (K̄): <span id="vK">50</span></label>
                    <input type="range" id="Kbar" min="10" max="100" value="50">
                </div>
                <div class="slider-row">
                    <label>Labor Endowment (L̄): <span id="vL">80</span></label>
                    <input type="range" id="Lbar" min="10" max="100" value="80">
                </div>
                <div class="slider-row">
                    <label>Capital Share (α): <span id="vA">0.30</span></label>
                    <input type="range" id="Alpha" min="0.1" max="0.9" step="0.05" value="0.3">
                </div>
                
                <div class="stat-row">
                    <div class="stat-box">
                        <span class="stat-label">Labor Share (wL/Y)</span>
                        <span id="sL" class="stat-val">70%</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Capital Share (rK/Y)</span>
                        <span id="sK" class="stat-val">30%</span>
                    </div>
                </div>
            </div>

            <div class="two-col">
                <div>
                    <div class="equation-label">MPL = (1-α)A(K/L)^α</div>
                    <canvas id="mplChart" height="250"></canvas>
                </div>
                <div>
                    <div class="equation-label">MPK = αA(L/K)^(1-α)</div>
                    <canvas id="mpkChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-panel">
            <div id="plot3d"></div>
            <div class="control-card" style="background: #ecf0f1; color: #2c3e50;">
                <p style="margin:0; font-size: 0.85em;">
                    <strong>Tip:</strong> The dot on the 3D surface shows the current Total Production (Y). 
                    The 2D curves to the left are the "Partial Derivatives" (slopes) of this surface at that specific dot.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    const A = 100;
    let mplChart, mpkChart;

    function initCharts() {
        const cfg = (label) => ({
            type: 'line',
            data: {
                labels: Array.from({length: 100}, (_, i) => i + 1),
                datasets: [
                    { label: label, data: [], borderColor: '#3498db', pointRadius: 0, tension: 0.2 },
                    { label: 'Supply', data: [], borderColor: '#2c3e50', borderDash: [5,5], pointRadius: 0 }
                ]
            },
            options: { 
                responsive: true, 
                animation: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });
        mplChart = new Chart(document.getElementById('mplChart'), cfg('Marginal Product of Labor'));
        mpkChart = new Chart(document.getElementById('mpkChart'), cfg('Marginal Product of Capital'));
    }

    function calculate3D(alpha) {
        let z = [];
        let xSize = 50; // K
        let ySize = 50; // L
        for(let i=0; i<xSize; i++) {
            let row = [];
            for(let j=0; j<ySize; j++) {
                let k = (i/xSize) * 100;
                let l = (j/ySize) * 100;
                row.push(A * Math.pow(k, alpha) * Math.pow(l, 1-alpha));
            }
            z.push(row);
        }
        return z;
    }

    function update() {
        const K_val = parseFloat(document.getElementById('Kbar').value);
        const L_val = parseFloat(document.getElementById('Lbar').value);
        const a_val = parseFloat(document.getElementById('Alpha').value);

        document.getElementById('vK').innerText = K_val;
        document.getElementById('vL').innerText = L_val;
        document.getElementById('vA').innerText = a_val.toFixed(2);

        // Update Shares
        document.getElementById('sL').innerText = ((1-a_val)*100).toFixed(0) + "%";
        document.getElementById('sK').innerText = (a_val*100).toFixed(0) + "%";

        // 2D Data
        let mplData = [], mpkData = [];
        for(let i=1; i<=100; i++) {
            mplData.push((1-a_val) * A * Math.pow(K_val, a_val) * Math.pow(i, -a_val));
            mpkData.push(a_val * A * Math.pow(i, a_val-1) * Math.pow(L_val, 1-a_val));
        }

        mplChart.data.datasets[0].data = mplData;
        mplChart.data.datasets[1].data = [{x: L_val, y: 0}, {x: L_val, y: 150}];
        mplChart.data.datasets[1].type = 'scatter'; mplChart.data.datasets[1].showLine = true;
        
        mpkChart.data.datasets[0].data = mpkData;
        mpkChart.data.datasets[1].data = [{x: K_val, y: 0}, {x: K_val, y: 100}];
        mpkChart.data.datasets[1].type = 'scatter'; mpkChart.data.datasets[1].showLine = true;

        mplChart.update();
        mpkChart.update();

        // 3D Plotly Update
        const zData = calculate3D(a_val);
        const currentY = A * Math.pow(K_val, a_val) * Math.pow(L_val, 1-a_val);

        const data = [{
            z: zData,
            type: 'surface',
            colorscale: 'Viridis',
            showscale: false,
            opacity: 0.8
        }, {
            x: [L_val/2], // Simplified mapping for index
            y: [K_val/2],
            z: [currentY],
            mode: 'markers',
            type: 'scatter3d',
            marker: { color: 'red', size: 8 }
        }];

        const layout = {
            title: 'Total Production Y = f(K, L)',
            autosize: true,
            margin: { l: 0, r: 0, b: 0, t: 30 },
            scene: {
                xaxis: { title: 'Labor (L)' },
                yaxis: { title: 'Capital (K)' },
                zaxis: { title: 'Output (Y)' }
            }
        };

        Plotly.react('plot3d', data, layout);
    }

    window.onload = () => {
        initCharts();
        update();
        document.querySelectorAll('input').forEach(i => i.addEventListener('input', update));
    };
</script>

</body>
</html>
