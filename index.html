<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ice Cream Factory: Professional Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap');
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background: #f0f2f5; 
            margin: 0; padding: 20px; 
            display: flex; justify-content: center;
        }

        .factory-box { 
            width: 1000px; 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border-top: 10px solid #ff8787; /* Strawberry top */
        }

        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { margin: 0; color: #4b3621; text-transform: uppercase; letter-spacing: 1px; }

        /* Fixed Grid Layout */
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: 350px 1fr; 
            gap: 25px; 
        }

        /* Sidebar Controls */
        .controls { 
            display: flex; flex-direction: column; gap: 15px; 
            background: #fff5f5; padding: 20px; border-radius: 15px;
        }
        .slider-group { margin-bottom: 10px; }
        .slider-group label { 
            display: flex; justify-content: space-between; 
            font-size: 0.85rem; font-weight: 700; color: #4b3621; margin-bottom: 5px;
        }
        input[type=range] { width: 100%; cursor: pointer; accent-color: #ff8787; }

        .price-section { 
            border-top: 2px dashed #ffc9c9; 
            padding-top: 15px; margin-top: 5px;
        }

        /* Chart Area */
        .chart-grid { display: grid; grid-template-rows: 1fr 1fr; gap: 20px; }
        .chart-wrapper { 
            position: relative; 
            height: 250px; /* FIXED HEIGHT TO PREVENT GROWING */
            width: 100%;
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 10px;
        }
        .chart-label {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            font-weight: 700; font-size: 0.8rem; color: #888; z-index: 10;
        }

        /* Stats */
        .stats { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 15px; margin-top: 20px; 
        }
        .stat-item { 
            background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center;
            border-bottom: 4px solid #dee2e6;
        }
        .stat-item.active { border-color: #51cf66; color: #2b8a3e; }
        .stat-item.error { border-color: #ff6b6b; color: #c92a2a; }
        .stat-val { font-size: 1.2rem; font-weight: 700; display: block; }
        .stat-name { font-size: 0.7rem; text-transform: uppercase; color: #adb5bd; }
    </style>
</head>
<body>

<div class="factory-box">
    <div class="header">
        <h1>Scoop-Master General Equilibrium</h1>
    </div>

    <div class="dashboard-grid">
        <div class="controls">
            <div class="slider-group">
                <label>Machines (K̄) <span id="vK">50</span></label>
                <input type="range" id="Kbar" min="10" max="100" value="50">
            </div>
            <div class="slider-group">
                <label>Scoopers (L̄) <span id="vL">80</span></label>
                <input type="range" id="Lbar" min="10" max="100" value="80">
            </div>
            <div class="slider-group">
                <label>Alpha (α) <span id="vA">0.30</span></label>
                <input type="range" id="Alpha" min="0.1" max="0.9" step="0.05" value="0.3">
            </div>

            <div class="price-section">
                <div class="slider-group">
                    <label style="color:#d9480f">Wage (w) <span id="vW">40</span></label>
                    <input type="range" id="Wage" min="10" max="150" value="40">
                </div>
                <div class="slider-group">
                    <label style="color:#087f5b">Rent (r) <span id="vR">20</span></label>
                    <input type="range" id="Rent" min="5" max="100" value="20">
                </div>
            </div>

            <div id="status" class="stat-item" style="margin-top:10px;">
                <span class="stat-name">Market Status</span>
                <span id="vStatus" class="stat-val">---</span>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart-wrapper">
                <div class="chart-label">Labor Market: MPL = (1-α)A(K/L)<sup>α</sup></div>
                <canvas id="chartL"></canvas>
            </div>
            <div class="chart-wrapper">
                <div class="chart-label">Capital Market: MPK = αA(L/K)<sup>1-α</sup></div>
                <canvas id="chartK"></canvas>
            </div>
        </div>
    </div>

    <div class="stats">
        <div class="stat-item">
            <span class="stat-name">Total Gallons (Y)</span>
            <span id="vY" class="stat-val">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-name">Labor Share (wL/Y)</span>
            <span id="vLS" class="stat-val">0%</span>
        </div>
        <div class="stat-item">
            <span class="stat-name">Capital Share (rK/Y)</span>
            <span id="vKS" class="stat-val">0%</span>
        </div>
    </div>
</div>

<script>
    const A = 100;
    let chartL, chartK;

    function initCharts() {
        const baseCfg = (color) => ({
            type: 'line',
            data: {
                labels: Array.from({length: 100}, (_, i) => i + 1),
                datasets: [
                    { label: 'MP', data: [], borderColor: color, borderWidth: 3, pointRadius: 0, tension: 0.2 },
                    { label: 'Supply', data: [], borderColor: '#4b3621', borderDash: [5,5], pointRadius: 0, showLine: true },
                    { label: 'Price', data: [], borderColor: '#fab005', borderWidth: 2, pointRadius: 0 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false, animation: false,
                plugins: { legend: { display: false } },
                scales: { 
                    x: { type: 'linear', min: 0, max: 100 },
                    y: { beginAtZero: true }
                }
            }
        });

        chartL = new Chart(document.getElementById('chartL'), baseCfg('#ff6b6b'));
        chartK = new Chart(document.getElementById('chartK'), baseCfg('#51cf66'));
        update();
    }

    function update() {
        const K = parseFloat(document.getElementById('Kbar').value);
        const L = parseFloat(document.getElementById('Lbar').value);
        const a = parseFloat(document.getElementById('Alpha').value);
        const w = parseFloat(document.getElementById('Wage').value);
        const r = parseFloat(document.getElementById('Rent').value);

        document.getElementById('vK').innerText = K;
        document.getElementById('vL').innerText = L;
        document.getElementById('vA').innerText = a.toFixed(2);
        document.getElementById('vW').innerText = w;
        document.getElementById('vR').innerText = r;

        const Y = A * Math.pow(K, a) * Math.pow(L, 1-a);
        const eqW = (1-a) * A * Math.pow(K, a) * Math.pow(L, -a);
        const eqR = a * A * Math.pow(K, a-1) * Math.pow(L, 1-a);

        // Update Stats
        document.getElementById('vY').innerText = Math.round(Y).toLocaleString();
        document.getElementById('vLS').innerText = ((w * L / Y) * 100).toFixed(1) + "%";
        document.getElementById('vKS').innerText = ((r * K / Y) * 100).toFixed(1) + "%";

        const isEquil = Math.abs(w-eqW) < 4 && Math.abs(r-eqR) < 3;
        const statusEl = document.getElementById('status');
        document.getElementById('vStatus').innerText = isEquil ? "EQUILIBRIUM" : "DISEQUILIBRIUM";
        statusEl.className = isEquil ? "stat-item active" : "stat-item error";

        // Generate Chart Data
        let dL = [], dK = [];
        for(let i=1; i<=100; i++) {
            dL.push({x: i, y: (1-a) * A * Math.pow(K, a) * Math.pow(i, -a)});
            dK.push({x: i, y: a * A * Math.pow(i, a-1) * Math.pow(L, 1-a)});
        }

        // Labor Chart Update
        chartL.data.datasets[0].data = dL;
        chartL.data.datasets[1].data = [{x: L, y: 0}, {x: L, y: 200}]; // High Y to ensure it hits top
        chartL.data.datasets[2].data = [{x: 0, y: w}, {x: 100, y: w}];
        chartL.options.scales.y.max = 160; 
        chartL.update();

        // Capital Chart Update
        chartK.data.datasets[0].data = dK;
        chartK.data.datasets[1].data = [{x: K, y: 0}, {x: K, y: 200}];
        chartK.data.datasets[2].data = [{x: 0, y: r}, {x: 100, y: r}];
        chartK.options.scales.y.max = 100;
        chartK.update();
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', update));
    window.onload = initCharts;
</script>
</body>
</html>
