<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Macro Equilibrium: Factor Markets</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; }
        .dashboard { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 900px; width: 95%; }
        .charts { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .controls { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .status-box { grid-column: span 2; text-align: center; border-top: 1px solid #555; padding-top: 10px; font-weight: bold; }
        .equilibrium-marker { color: #2ecc71; }
        .disequilibrium-marker { color: #e74c3c; }
    </style>
</head>
<body>

<div class="dashboard">
    <h2>Chapter II: Production & Factor Market Equilibrium</h2>
    
    <div class="controls">
        <div>
            <label>Market Price of Capital (r): <span id="rVal">15</span></label><br>
            <input type="range" id="priceR" min="5" max="45" value="15" style="width:100%">
        </div>
        <div>
            <label>Fixed Capital Supply (\(\bar{K}\)): 50</label><br>
            <small>Supply is fixed by the economy's endowments.</small>
        </div>
        <div class="status-box" id="marketStatus">
            Checking Market Condition...
        </div>
    </div>

    <div class="charts">
        <div>
            <canvas id="capMarketChart"></canvas>
            <p style="font-size: 0.8em; text-align: center;"><b>Capital Market:</b> Fixed Supply vs. Firm Demand (MPK)</p>
        </div>
        <div>
            <canvas id="mplChart"></canvas>
            <p style="font-size: 0.8em; text-align: center;"><b>Labor Productivity:</b> Marginal Product of Labor at \(\bar{K}\)</p>
        </div>
    </div>
</div>

<script>
    const ctx1 = document.getElementById('capMarketChart').getContext('2d');
    const ctx2 = document.getElementById('mplChart').getContext('2d');
    
    // Parameters from your slides
    const A = 100;
    const alpha = 0.3;
    const K_bar = 50;
    const L_bar = 80;

    // Calc Equilibrium r*
    const r_star = alpha * A * Math.pow(K_bar, alpha - 1) * Math.pow(L_bar, 1 - alpha);

    let capChart = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: Array.from({length: 100}, (_, i) => i + 1),
            datasets: [
                { label: 'Demand (MPK)', data: [], borderColor: '#3498db', pointRadius: 0 },
                { label: 'Supply (K-bar)', data: [], borderColor: '#2c3e50', borderDash: [5,5], pointRadius: 0 },
                { label: 'Current Price (r)', data: [], borderColor: '#e74c3c', borderWidth: 2, pointRadius: 0 }
            ]
        },
        options: { scales: { y: { min: 0, max: 50 }, x: { title: {display:true, text:'Capital (K)'} } } }
    });

    let mplChart = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: Array.from({length: 100}, (_, i) => i + 1),
            datasets: [{ label: 'MPL', data: [], borderColor: '#27ae60', pointRadius: 0 }]
        },
        options: { scales: { y: { min: 0, max: 150 }, x: { title: {display:true, text:'Labor (L)'} } } }
    });

    function update() {
        const r = parseFloat(document.getElementById('priceR').value);
        document.getElementById('rVal').innerText = r.toFixed(1);

        // Calculate Demand for Capital at current r: r = alpha * A * K^(a-1) * L^(1-a)
        // K_demand = [ r / (alpha * A * L_bar^(1-a)) ] ^ (1 / (alpha - 1))
        const K_demand = Math.pow(r / (alpha * A * Math.pow(L_bar, 1-alpha)), 1/(alpha-1));

        const mpkData = [];
        const supplyData = [];
        const priceLine = [];
        const mplData = [];

        for(let k=1; k<=100; k++) {
            mpkData.push(alpha * A * Math.pow(k, alpha-1) * Math.pow(L_bar, 1-alpha));
            supplyData.push(k === K_bar ? 50 : null); // Vertical line logic
            priceLine.push(r);
        }
        
        // Supply line fix for Chart.js (Vertical line at K=50)
        capChart.data.datasets[1].data = [{x: 50, y: 0}, {x: 50, y: 50}];
        capChart.data.datasets[1].type = 'scatter';
        capChart.data.datasets[1].showLine = true;

        for(let l=1; l<=100; l++) {
            mplData.push((1-alpha) * A * Math.pow(K_bar, alpha) * Math.pow(l, -alpha));
        }

        capChart.data.datasets[0].data = mpkData;
        capChart.data.datasets[2].data = priceLine;
        mplChart.data.datasets[0].data = mplData;

        // Market Status Logic
        const statusEl = document.getElementById('marketStatus');
        if (Math.abs(r - r_star) < 1) {
            statusEl.innerHTML = `<span class="equilibrium-marker">EQUILIBRIUM: r â‰ˆ ${r_star.toFixed(2)}. Market Clears!</span>`;
        } else if (r > r_star) {
            statusEl.innerHTML = `<span class="disequilibrium-marker">EXCESS SUPPLY: Price is too high. Firms only want ${K_demand.toFixed(1)} units of capital.</span>`;
        } else {
            statusEl.innerHTML = `<span class="disequilibrium-marker">EXCESS DEMAND: Price is too low. Firms want ${K_demand.toFixed(1)} units of capital!</span>`;
        }

        capChart.update();
        mplChart.update();
    }

    document.getElementById('priceR').addEventListener('input', update);
    update();
</script>
</body>
</html>
