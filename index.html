<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Macro Factor Market Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* Top Control Bar */
        .params-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        
        /* Price Control Bar */
        .price-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; padding: 15px; border: 2px solid #3498db; border-radius: 10px; margin-bottom: 20px; }
        
        .slider-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 0.9em; }
        input[type=range] { cursor: pointer; }

        /* Income Shares Box */
        .shares-container { display: flex; justify-content: space-around; margin-bottom: 20px; gap: 15px; }
        .share-card { flex: 1; text-align: center; padding: 15px; border-radius: 8px; color: white; font-weight: bold; }
        .labor-bg { background: #27ae60; }
        .capital-bg { background: #2980b9; }

        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-wrap { position: relative; height: 350px; }
        
        .formula { font-family: "Times New Roman", Times, serif; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h2>Factor Market Equilibrium & Income Distribution</h2>
    
    <div class="params-bar">
        <div class="slider-group">
            <label>Capital Endowment (<span class="formula">K̄</span>): <span id="valKbar">50</span></label>
            <input type="range" id="paramK" min="10" max="100" value="50">
        </div>
        <div class="slider-group">
            <label>Labor Endowment (<span class="formula">L̄</span>): <span id="valLbar">80</span></label>
            <input type="range" id="paramL" min="10" max="100" value="80">
        </div>
        <div class="slider-group">
            <label>Capital Share (<span class="formula">α</span>): <span id="valAlpha">0.30</span></label>
            <input type="range" id="paramAlpha" min="0.1" max="0.9" step="0.05" value="0.3">
        </div>
    </div>

    <div class="shares-container">
        <div class="share-card labor-bg">
            Labor Income Share (wL / Y): <span id="shareL">--</span>
        </div>
        <div class="share-card capital-bg">
            Capital Income Share (rK / Y): <span id="shareK">--</span>
        </div>
    </div>

    <div class="price-bar">
        <div class="slider-group">
            <label>Market Real Wage (<span class="formula">w</span>): <span id="valW">40</span></label>
            <input type="range" id="priceW" min="5" max="100" value="43">
        </div>
        <div class="slider-group">
            <label>Market Rental Rate (<span class="formula">r</span>): <span id="valR">15</span></label>
            <input type="range" id="priceR" min="5" max="50" value="18">
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-wrap"><canvas id="laborChart"></canvas></div>
        <div class="chart-wrap"><canvas id="capitalChart"></canvas></div>
    </div>
</div>

<script>
    const A = 100;
    let laborChart, capitalChart;

    const els = {
        K: document.getElementById('paramK'),
        L: document.getElementById('paramL'),
        A: document.getElementById('paramAlpha'),
        W: document.getElementById('priceW'),
        R: document.getElementById('priceR'),
        dispK: document.getElementById('valKbar'),
        dispL: document.getElementById('valLbar'),
        dispA: document.getElementById('valAlpha'),
        dispW: document.getElementById('valW'),
        dispR: document.getElementById('valR'),
        shareL: document.getElementById('shareL'),
        shareK: document.getElementById('shareK')
    };

    function init() {
        const config = (title, max) => ({
            type: 'line',
            data: {
                labels: Array.from({length: 101}, (_, i) => i),
                datasets: [
                    { label: 'Demand (MP)', data: [], borderColor: '#3498db', pointRadius: 0, tension: 0.2 },
                    { label: 'Supply (Fixed)', data: [], borderColor: '#2c3e50', borderDash: [5,5], pointRadius: 0 },
                    { label: 'Market Price', data: [], borderColor: '#e74c3c', borderWidth: 2, pointRadius: 0 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false, 
                animation: false,
                scales: { y: { min: 0, max: max }, x: { title: { display: true, text: title } } }
            }
        });

        laborChart = new Chart(document.getElementById('laborChart'), config('Quantity of Labor', 120));
        capitalChart = new Chart(document.getElementById('capitalChart'), config('Quantity of Capital', 60));
        update();
    }

    function update() {
        const K_bar = parseFloat(els.K.value);
        const L_bar = parseFloat(els.L.value);
        const alpha = parseFloat(els.A.value);
        const w = parseFloat(els.W.value);
        const r = parseFloat(els.R.value);

        els.dispK.innerText = K_bar;
        els.dispL.innerText = L_bar;
        els.dispA.innerText = alpha.toFixed(2);
        els.dispW.innerText = w;
        els.dispR.innerText = r;

        // 1. Calculate Production and Shares
        const Y = A * Math.pow(K_bar, alpha) * Math.pow(L_bar, 1 - alpha);
        const eqW = (1 - alpha) * A * Math.pow(K_bar, alpha) * Math.pow(L_bar, -alpha);
        const eqR = alpha * A * Math.pow(K_bar, alpha - 1) * Math.pow(L_bar, 1 - alpha);

        // Calculate shares based on MARKET prices vs Output
        // Note: In strict equilibrium w=eqW and r=eqR, so shares are (1-alpha) and alpha.
        // If prices are disequilibrium, we show the current income ratio.
        const labShare = (w * L_bar / Y) * 100;
        const capShare = (r * K_bar / Y) * 100;
        
        els.shareL.innerText = labShare.toFixed(1) + "%";
        els.shareK.innerText = capShare.toFixed(1) + "%";

        // 2. Generate Graph Data
        const mplData = [], mpkData = [], wLine = [], rLine = [];
        for (let i = 1; i <= 100; i++) {
            mplData.push((1 - alpha) * A * Math.pow(K_bar, alpha) * Math.pow(i, -alpha));
            mpkData.push(alpha * A * Math.pow(i, alpha - 1) * Math.pow(L_bar, 1 - alpha));
            wLine.push(w);
            rLine.push(r);
        }

        // 3. Update Labor Chart
        laborChart.data.datasets[0].data = mplData;
        laborChart.data.datasets[1].data = [{x: L_bar, y: 0}, {x: L_bar, y: 120}]; // Vertical
        laborChart.data.datasets[1].type = 'scatter'; laborChart.data.datasets[1].showLine = true;
        laborChart.data.datasets[2].data = wLine;
        laborChart.update();

        // 4. Update Capital Chart
        capitalChart.data.datasets[0].data = mpkData;
        capitalChart.data.datasets[1].data = [{x: K_bar, y: 0}, {x: K_bar, y: 60}]; // Vertical
        capitalChart.data.datasets[1].type = 'scatter'; capitalChart.data.datasets[1].showLine = true;
        capitalChart.data.datasets[2].data = rLine;
        capitalChart.update();
    }

    [els.K, els.L, els.A, els.W, els.R].forEach(input => input.addEventListener('input', update));
    window.onload = init;
</script>
</body>
</html>
