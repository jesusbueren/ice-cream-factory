<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Ice Cream Factory Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        
        :root {
            --mint: #b2f2bb;
            --strawberry: #ffc9c9;
            --vanilla: #fff9db;
            --chocolate: #4b3621;
            --cream: #f8f9fa;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #a5d8ff, #ffec99); 
            color: #2c3e50; margin: 0; padding: 20px; min-height: 100vh;
        }

        .factory-container { 
            max-width: 1100px; margin: auto; background: white; 
            padding: 30px; border-radius: 25px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border: 8px solid var(--vanilla);
        }

        h1 { text-align: center; color: var(--chocolate); font-weight: 800; text-transform: uppercase; letter-spacing: 2px; }

        /* Control Panel Styles */
        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .control-section { background: var(--cream); padding: 20px; border-radius: 15px; border: 2px solid #e9ecef; }
        .section-title { font-weight: 800; font-size: 0.9rem; margin-bottom: 15px; color: var(--chocolate); display: flex; align-items: center; gap: 8px; }

        .slider-row { margin-bottom: 15px; }
        .slider-row label { display: flex; justify-content: space-between; font-weight: 600; font-size: 0.85rem; margin-bottom: 5px; }
        input[type=range] { width: 100%; accent-color: #ff922b; cursor: pointer; }

        /* Stat Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { padding: 20px; border-radius: 15px; text-align: center; color: white; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .bg-output { background: #5c7cfa; }
        .bg-labor { background: #ff6b6b; }
        .bg-capital { background: #51cf66; }
        .stat-val { font-size: 1.8rem; font-weight: 800; display: block; }
        .stat-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; opacity: 0.9; }

        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-box { background: white; padding: 15px; border-radius: 15px; border: 2px solid #f1f3f5; position: relative; }
        .formula-tag { position: absolute; top: 10px; right: 20px; font-size: 0.7rem; font-style: italic; color: #adb5bd; }
    </style>
</head>
<body>

<div class="factory-container">
    <h1>üç¶ The Ice Cream Factory</h1>

    <div class="stats-grid">
        <div class="stat-card bg-output">
            <span class="stat-label">Total Gallons Produced (Y)</span>
            <span id="statY" class="stat-val">0</span>
        </div>
        <div class="stat-card bg-labor">
            <span class="stat-label">Scooper Income Share (wL/Y)</span>
            <span id="statLS" class="stat-val">0%</span>
        </div>
        <div class="stat-card bg-capital">
            <span class="stat-label">Machine Owner Share (rK/Y)</span>
            <span id="statKS" class="stat-val">0%</span>
        </div>
    </div>

    <div class="control-grid">
        <div class="control-section">
            <div class="section-title">üè≠ Factory Resources (K & L)</div>
            <div class="slider-row">
                <label>Machines (K-bar) <span id="outK">50</span></label>
                <input type="range" id="Kbar" min="10" max="100" value="50">
            </div>
            <div class="slider-row">
                <label>Scoopers (L-bar) <span id="outL">80</span></label>
                <input type="range" id="Lbar" min="10" max="100" value="80">
            </div>
            <div class="slider-row">
                <label>Machine Intensity (Œ±) <span id="outA">0.30</span></label>
                <input type="range" id="Alpha" min="0.1" max="0.9" step="0.05" value="0.30">
            </div>
        </div>

        <div class="control-section" style="border-left: 4px solid #fab005;">
            <div class="section-title">üí∞ Market Prices (w & r)</div>
            <div class="slider-row">
                <label>Hourly Wage (w) <span id="outW">40</span></label>
                <input type="range" id="Wage" min="5" max="120" value="40">
            </div>
            <div class="slider-row">
                <label>Machine Rent (r) <span id="outR">20</span></label>
                <input type="range" id="Rent" min="5" max="80" value="20">
            </div>
            <div id="statusMsg" style="text-align: center; font-weight: 800; font-size: 0.8rem; margin-top: 15px;"></div>
        </div>
    </div>

    <div class="chart-grid">
        <div class="chart-box">
            <div class="section-title">Scooper Market (L)</div>
            <span class="formula-tag">MPL = (1-Œ±) * (Y/L)</span>
            <canvas id="chartL" height="300"></canvas>
        </div>
        <div class="chart-box">
            <div class="section-title">Machine Market (K)</div>
            <span class="formula-tag">MPK = Œ± * (Y/K)</span>
            <canvas id="chartK" height="300"></canvas>
        </div>
    </div>
</div>

<script>
    const A = 100;
    let chartL, chartK;

    function init() {
        const options = (title, max) => ({
            responsive: true, maintainAspectRatio: false, animation: false,
            plugins: { legend: { display: false } },
            scales: { 
                x: { type: 'linear', min: 0, max: 100, title: { display: true, text: title, font: { weight: 'bold' } } },
                y: { min: 0, max: max }
            }
        });

        chartL = new Chart(document.getElementById('chartL'), {
            type: 'line',
            data: { datasets: [
                { label: 'Marginal Product', data: [], borderColor: '#ff6b6b', borderWidth: 3, pointRadius: 0, tension: 0.3 },
                { label: 'Supply (L-bar)', data: [], borderColor: '#4b3621', borderDash: [5,5], pointRadius: 0, showLine: true },
                { label: 'Market Wage', data: [], borderColor: '#fab005', borderWidth: 2, pointRadius: 0 }
            ]},
            options: options('Quantity of Scoopers', 150)
        });

        chartK = new Chart(document.getElementById('chartK'), {
            type: 'line',
            data: { datasets: [
                { label: 'Marginal Product', data: [], borderColor: '#51cf66', borderWidth: 3, pointRadius: 0, tension: 0.3 },
                { label: 'Supply (K-bar)', data: [], borderColor: '#4b3621', borderDash: [5,5], pointRadius: 0, showLine: true },
                { label: 'Machine Rent', data: [], borderColor: '#fab005', borderWidth: 2, pointRadius: 0 }
            ]},
            options: options('Quantity of Machines', 100)
        });

        update();
    }

    function update() {
        const K = parseFloat(document.getElementById('Kbar').value);
        const L = parseFloat(document.getElementById('Lbar').value);
        const a = parseFloat(document.getElementById('Alpha').value);
        const w = parseFloat(document.getElementById('Wage').value);
        const r = parseFloat(document.getElementById('Rent').value);

        document.getElementById('outK').innerText = K;
        document.getElementById('outL').innerText = L;
        document.getElementById('outA').innerText = a.toFixed(2);
        document.getElementById('outW').innerText = w;
        document.getElementById('outR').innerText = r;

        const Y = A * Math.pow(K, a) * Math.pow(L, 1-a);
        const eqW = (1-a) * A * Math.pow(K, a) * Math.pow(L, -a);
        const eqR = a * A * Math.pow(K, a-1) * Math.pow(L, 1-a);

        document.getElementById('statY').innerText = Math.round(Y).toLocaleString();
        document.getElementById('statLS').innerText = ((w * L / Y) * 100).toFixed(1) + "%";
        document.getElementById('statKS').innerText = ((r * K / Y) * 100).toFixed(1) + "%";

        const isEquil = Math.abs(w-eqW) < 3 && Math.abs(r-eqR) < 2;
        const msg = document.getElementById('statusMsg');
        msg.innerText = isEquil ? "‚úÖ MARKET CLEARED" : "‚ùå DISEQUILIBRIUM";
        msg.style.color = isEquil ? "#2f9e44" : "#e03131";

        // Chart Data
        let dMPL = [], dMPK = [];
        for(let i=1; i<=100; i++) {
            dMPL.push({x: i, y: (1-a) * A * Math.pow(K, a) * Math.pow(i, -a)});
            dMPK.push({x: i, y: a * A * Math.pow(i, a-1) * Math.pow(L, 1-a)});
        }

        // Update Scoopers Chart
        chartL.data.datasets[0].data = dMPL;
        chartL.data.datasets[1].data = [{x: L, y: 0}, {x: L, y: 150}]; // Vertical to top
        chartL.data.datasets[2].data = [{x: 0, y: w}, {x: 100, y: w}];
        chartL.update();

        // Update Machines Chart
        chartK.data.datasets[0].data = dMPK;
        chartK.data.datasets[1].data = [{x: K, y: 0}, {x: K, y: 100}]; // Vertical to top
        chartK.data.datasets[2].data = [{x: 0, y: r}, {x: 100, y: r}];
        chartK.update();
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', update));
    window.onload = init;
</script>
</body>
</html>
